(()=>{var e={6135:(e,t,n)=>{"use strict";var r=n(7546),i=n(4634),o=(n(3792),n(3362),n(9085),n(9391),n(5471)),s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view"),e._l(e.modals,(function(n,r){return t("base-modal",e._b({key:r,on:{close:function(t){return e.hideModal(r)}}},"base-modal",n,!1))})),t("term-tooltip",{attrs:{show:e.tooltipShow,description:e.tooltipDescription,imageUrl:e.tooltipImageUrl,term:e.tooltipTerm,event:e.tooltipEvent}})],2)},a=[],c=(n(2675),n(9463),function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"modal-fade"}},[e.show?t("div",{staticClass:"modal",on:{click:function(t){if(t.target!==t.currentTarget)return null;e.closeOnBackdrop&&e.close()}}},[t("div",{staticClass:"modal-content",class:{"modal-large":e.large}},[t("h2",[e._v(e._s(e.title))]),t("div",{staticClass:"modal-scroll",domProps:{innerHTML:e._s(e.content)}}),t("div",{staticClass:"button-container"},[e._t("buttons",(function(){return[t("button",{staticClass:"button",on:{click:e.close}},[e._v(e._s(e.closeButtonText))])]}))],2)])]):e._e()])}),u=[];const l={name:"BaseModal",props:{show:{type:Boolean,required:!0},title:{type:String,default:""},content:{type:String,default:""},closeButtonText:{type:String,default:"关闭"},closeOnBackdrop:{type:Boolean,default:!0},large:{type:Boolean,default:!1}},methods:{close:function(){this.$emit("close")}},watch:{show:function(e){document.body.style.overflow=e?"hidden":""}},beforeUnmount:function(){this.escapeEnabled&&document.removeEventListener("keydown",this.handleEscape)}},p=l;var d=n(1656),h=(0,d.A)(p,c,u,!1,null,"011dfa3f",null);const m=h.exports;var g=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],style:e.tooltipStyle,attrs:{id:"term-tooltip"},on:{click:function(e){e.stopPropagation()}}},[t("span",{domProps:{innerHTML:e._s(e.highlightedDescription)}}),e.imageUrl?t("img",{staticClass:"term-tooltip-image",attrs:{src:e.imageUrl,alt:"术语图片"},on:{load:e.updatePosition}}):e._e()])},f=[],v=n(7180),A=(n(6280),n(6918),n(8706),n(1629),n(2062),n(4114),n(4782),n(6910),n(3288),n(9432),n(6099),n(6034),n(8940),n(4864),n(7465),n(7495),n(7745),n(8781),n(7764),n(5440),n(375),n(3500),n(2953),n(6031),(0,o.KR)({})),y=(0,o.KR)({});function S(){return b.apply(this,arguments)}function b(){return b=(0,i.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("lang/terms_explanations_zh-CN.json?v="+(new Date).getTime());case 3:return t=e.sent,e.next=6,t.json();case 6:A.value=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),console.error("加载名词配置文件时出错:",e.t0);case 13:k();case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),b.apply(this,arguments)}function _(){return w.apply(this,arguments)}function w(){return w=(0,i.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("config/colors.json?v="+(new Date).getTime());case 3:return t=e.sent,e.next=6,t.json();case 6:y.value=e.sent,console.log("Loaded colors config:",y.value),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),console.error("加载色盘配置文件时出错:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),w.apply(this,arguments)}function T(e){var t=e.replace("#",""),n=parseInt(t.substr(0,2),16),r=parseInt(t.substr(2,2),16),i=parseInt(t.substr(4,2),16),o=.299*n+.587*r+.114*i;return o<128}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=A.value.terms,r=y.value.colors,i=[],o=2,s={};return Object.keys(n).forEach((function(a){if(a!==t){var c,u=r[n[a].color]||n[a].color,l=new RegExp(a,"g");while(null!==(c=l.exec(e)))if(s[a]=(s[a]||0)+1,s[a]<=o){var p=T(u),d=p?"-1px -1px 2px #222, 1px -1px 2px #222, -1px 1px 2px #222, 1px 1px 2px #222":"-1px -1px 2px #000, 1px -1px 2px #000, -1px 1px 2px #000, 1px 1px 2px #000";i.push({term:a,start:c.index,end:c.index+a.length,color:u,textShadow:d})}}})),i.sort((function(e,t){return t.start-e.start})),i.forEach((function(t){e=e.slice(0,t.start)+'<span class="special-term" style="font-weight: bold; color: '.concat(t.color,"; text-shadow: ").concat(t.textShadow,';" data-term="').concat(t.term,'">').concat(t.term,"</span>")+e.slice(t.end)})),e}function k(){return C.apply(this,arguments)}function C(){return C=(0,i.A)((0,r.A)().mark((function e(){var t,n,i,o,s,a,c=arguments;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=c.length>0&&void 0!==c[0]?c[0]:5,n=c.length>1&&void 0!==c[1]?c[1]:1e3,i=[],Object.values(A.value.terms).forEach((function(e){e.imageUrl&&i.push(e.imageUrl)})),o=0;case 5:if(!(o<i.length)){e.next=22;break}return s=i.slice(o,o+t),a=s.map((function(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t(e)},r.onerror=function(){return n(new Error("Failed to load image: ".concat(e)))}}))})),e.prev=8,e.next=11,Promise.all(a);case 11:console.log("Batch ".concat(Math.floor(o/t)+1," preloaded successfully")),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](8),console.error("Error preloading images:",e.t0);case 17:return e.next=19,new Promise((function(e){return setTimeout(e,n)}));case 19:o+=t,e.next=5;break;case 22:console.log("All images preloaded successfully");case 23:case"end":return e.stop()}}),e,null,[[8,14]])}))),C.apply(this,arguments)}const E={name:"TermTooltip",props:{show:Boolean,description:String,imageUrl:String,term:String,event:Object},setup:function(e){var t=(0,o.KR)({position:"fixed",display:"none",minWidth:"150px"}),n=(0,o.EW)((function(){return x(e.description,e.term)}));function r(){if(e.event){var n=document.documentElement.clientWidth,r=document.documentElement.clientHeight,i=document.getElementById("term-tooltip");if(i){var o=i.offsetWidth,s=i.offsetHeight,a=e.event.clientY+10,c=e.event.clientX+10,u=n/3,l=e.event.clientX;c=l<=u?e.event.clientX+10:l>=2*u?e.event.clientX-o-10:Math.max(10,e.event.clientX-o/2),a+s>r&&(a=r-s-10),c<0?c=10:c+o>n&&(c=n-o-10),t.value=(0,v.A)((0,v.A)({},t.value),{},{top:"".concat(a,"px"),left:"".concat(c,"px")})}}}return{tooltipStyle:t,highlightedDescription:n,updatePosition:r}}},I=E;var P=(0,d.A)(I,g,f,!1,null,"e19172da",null);const O=P.exports,N={name:"App",components:{BaseModal:m,TermTooltip:O},setup:function(){var e=(0,o.KR)(!1),t=(0,o.KR)(""),n=(0,o.KR)(""),r=(0,o.KR)(""),i=(0,o.KR)(null);function s(o){if(o.target.classList.contains("special-term")){var s=o.target.getAttribute("data-term"),a=A.value.terms[s];t.value=a.description,n.value=a.imageUrl,r.value=s,i.value=o,e.value=!0}else o.target.closest("#term-tooltip")||(e.value=!1)}return S(),_(),document.addEventListener("click",s),{tooltipShow:e,tooltipDescription:t,tooltipImageUrl:n,tooltipTerm:r,tooltipEvent:i}}},M=N;var R=(0,d.A)(M,s,a,!1,null,null,null);const L=R.exports;var U=n(173),D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container",attrs:{id:"menu"}},[t("h1",[e._v(e._s(e.$t("mainTitle")))]),t("h2",[e._v(e._s(e.$t("subTitle")))]),t("p",{attrs:{id:"gameDescription"}},[e._v(e._s(e.$t("gameDescription")))]),t("div",{staticClass:"menu-controls"},[t("div",{staticClass:"control-pair",attrs:{id:"footerControl"}},[t("button",{staticClass:"button",on:{click:e.showCreatorsMessage}},[e._v(" "+e._s(e.$t("creatorsMessage"))+" ")]),t("button",{staticClass:"button",on:{click:e.showUpdateLog}},[e._v(" "+e._s(e.$t("updateLog"))+" ")])]),e.hasSave?e._e():t("button",{staticClass:"button",on:{click:e.startNewGame}},[e._v(" "+e._s(e.$t("newGame"))+" ")]),e.hasSave?t("div",{staticClass:"control-pair"},[t("button",{staticClass:"button",on:{click:e.continueGame}},[e._v(" "+e._s(e.$t("continueGame"))+" ")]),t("button",{staticClass:"button",on:{click:e.showReviewRecords}},[e._v(" "+e._s(e.$t("reviewRecords"))+" ")])]):e._e(),t("div",{staticClass:"control-pair"},[t("button",{staticClass:"button",on:{click:e.triggerFileInput}},[e._v(" "+e._s(e.$t("importSave"))+" ")]),e.hasSave?t("button",{staticClass:"button",on:{click:e.exportSave}},[e._v(" "+e._s(e.$t("exportSave"))+" ")]):e._e()]),t("div",{staticClass:"control-pair"},[t("button",{staticClass:"button",on:{click:e.openSettings}},[t("img",{attrs:{src:n(3005),alt:""}}),e._v(" "+e._s(e.$t("settings"))+" ")]),e.hasSave?t("button",{staticClass:"button",on:{click:e.confirmDeleteSave}},[e._v(" "+e._s(e.$t("deleteSave"))+" ")]):e._e()])]),t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".savegame"},on:{change:e.handleFileSelect}}),t("router-link",{staticClass:"menu-item",attrs:{to:"/review"}},[e._v(" "+e._s(e.$t("reviewTitle"))+" ")])],1)},B=[],j=n(5353);const $={name:"HomeView",computed:(0,v.A)({},(0,j.L8)("save",["hasSave"])),methods:(0,v.A)((0,v.A)({},(0,j.i0)("save",["clearSave","exportSave","importSave"])),{},{startNewGame:function(){this.clearSave(),this.$router.push("/sections")},continueGame:function(){this.$router.push("/sections")},showReviewRecords:function(){this.$router.push("/review")},openSettings:function(){this.$router.push("/settings")},triggerFileInput:function(){this.hasSave&&!confirm(this.$t("confirmImport"))||this.$refs.fileInput.click()},handleFileSelect:function(e){var t=this;return(0,i.A)((0,r.A)().mark((function n(){var i;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.target.files[0],i){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,n.next=6,t.importSave(i);case 6:t.$modal.show("success",{title:t.$t("success"),content:t.$t("importSuccess")}),location.reload(),n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](3),t.$modal.show("error",{title:t.$t("error"),content:n.t0.message});case 13:return n.prev=13,e.target.value="",n.finish(13);case 16:case"end":return n.stop()}}),n,null,[[3,10,13,16]])})))()},confirmDeleteSave:function(){var e=this;return(0,i.A)((0,r.A)().mark((function t(){return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!confirm(e.$t("confirmDelete"))){t.next=4;break}return t.next=3,e.clearSave();case 3:location.reload();case 4:case"end":return t.stop()}}),t)})))()},showCreatorsMessage:function(){this.$modal.show("creators-message")},showUpdateLog:function(){this.$modal.show("update-log")}})},K=$;var G=(0,d.A)(K,D,B,!1,null,"2dff2b9f",null);const H=G.exports;var V=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sections-container"},[t("h2",[e._v(e._s(e.$t("chooseSection")))]),e._l(e.chapters,(function(n){return t("div",{key:n.title,staticClass:"chapter"},[t("h3",[e._v(e._s(n.title))]),e._l(n.sections,(function(n){return t("div",{key:n.id,staticClass:"section"},[e.isSectionCompleted(n.id)?[t("button",{staticClass:"button completed",on:{click:function(t){return e.replaySection(n.file)}}},[e._v(" "+e._s(n.title)+" ("+e._s(e.$t("completed"))+") - "+e._s(e.$t("replay"))+" ")])]:e.isSectionUnlocked(n.id)?[t("div",{staticClass:"section-content"},[t("img",{attrs:{src:n.image,alt:"".concat(n.title," thumbnail")}}),t("button",{staticClass:"button",on:{click:function(t){return e.chooseSection(n.file)}}},[e._v(" "+e._s(n.title)+" ")]),t("button",{staticClass:"button button-skip",on:{click:function(t){return e.skipSection(n.file)}}},[e._v(" "+e._s(e.$t("skip"))+" "+e._s(n.title)+" ")])])]:[t("div",{staticClass:"locked-section"},[e._v(" "+e._s(n.title)+" ("+e._s(e.$t("locked"))+") ")])]],2)}))],2)})),t("button",{staticClass:"button",on:{click:e.returnToMenu}},[e._v(e._s(e.$t("returnToMenu")))])],2)},z=[];const F={name:"SectionsView",computed:(0,v.A)((0,v.A)({},(0,j.aH)("sections",["chapters","unlockedSections","completedSections"])),(0,j.L8)("sections",["isSectionUnlocked","isSectionCompleted"])),methods:(0,v.A)((0,v.A)((0,v.A)({},(0,j.i0)("sections",["loadSection","skipSection"])),(0,j.i0)("game",["initializeGame"])),{},{chooseSection:function(e){var t=this;return(0,i.A)((0,r.A)().mark((function n(){var i;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.loadSection(e);case 2:return i=t.$store.getters["sections/getCurrentSection"],n.next=5,t.initializeGame(i);case 5:t.$router.push("/story");case 6:case"end":return n.stop()}}),n)})))()},replaySection:function(e){var t=this;return(0,i.A)((0,r.A)().mark((function n(){var i;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.loadSection(e);case 2:return i=t.$store.getters["sections/getCurrentSection"],n.next=5,t.initializeGame(i,!0);case 5:t.$router.push("/story");case 6:case"end":return n.stop()}}),n)})))()},skipSection:function(e){var t=this;return(0,i.A)((0,r.A)().mark((function n(){return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.skipSection(e);case 2:t.$toast.success(t.$t("sectionSkipped"));case 3:case"end":return n.stop()}}),n)})))()},returnToMenu:function(){this.$router.push("/")}}),created:function(){0===this.chapters.length&&this.$store.dispatch("sections/loadSectionsIndex")}},Y=F;var W=(0,d.A)(Y,V,z,!1,null,"5a6685ce",null);const J=W.exports;var Q=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"story-container"},[t("h2",[e._v(e._s(e.section.title))]),e.section.image?t("lazy-image",{attrs:{src:e.section.image,alt:e.section.title}}):e._e(),e.section.musicUrl?t("music-player",{attrs:{"music-url":e.section.musicUrl}}):e._e()],1)},q=[],X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lazy-image-container"},[e.isLoaded?t("img",{staticClass:"lazy-image",attrs:{src:e.src,alt:e.alt},on:{load:e.onLoad,error:e.onError}}):t("div",{staticClass:"image-placeholder"},[t("span",[e._v("加载中...")])])])},Z=[],ee=n(7552),te=n(6654),ne=(n(5276),n(6033),n(1415),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698),function(){function e(){(0,ee.A)(this,e),this.loadedImages=new Set,this.loading=new Map}return(0,te.A)(e,[{key:"preloadImage",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i=this;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loadedImages.has(t)){e.next=2;break}return e.abrupt("return",t);case 2:if(!this.loading.has(t)){e.next=4;break}return e.abrupt("return",this.loading.get(t));case 4:return n=new Promise((function(e,n){var r=new Image;r.onload=function(){i.loadedImages.add(t),i.loading["delete"](t),e(t)},r.onerror=function(){i.loading["delete"](t),n(new Error("Failed to load image: ".concat(t)))},r.src=t})),this.loading.set(t,n),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"preloadBatch",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i,o,s,a,c,u,l,p=this,d=arguments;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(n=d.length>1&&void 0!==d[1]?d[1]:3,i=d.length>2&&void 0!==d[2]?d[2]:1e3,o=[],s=0;s<t.length;s+=n)a=t.slice(s,s+n),o.push(a);c=0,u=o;case 5:if(!(c<u.length)){e.next=21;break}return l=u[c],e.prev=7,e.next=10,Promise.all(l.map((function(e){return p.preloadImage(e)})));case 10:if(!(o.indexOf(l)<o.length-1)){e.next=13;break}return e.next=13,new Promise((function(e){return setTimeout(e,i)}));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](7),console.error("Error preloading batch:",e.t0);case 18:c++,e.next=5;break;case 21:case"end":return e.stop()}}),e,null,[[7,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isImageLoaded",value:function(e){return this.loadedImages.has(e)}}])}()),re=new ne;const ie={name:"LazyImage",props:{src:{type:String,required:!0},alt:{type:String,default:""}},setup:function(e){var t=(0,o.KR)(re.isImageLoaded(e.src));return(0,o.sV)((0,i.A)((0,r.A)().mark((function n(){return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.value){n.next=10;break}return n.prev=1,n.next=4,re.preloadImage(e.src);case 4:t.value=!0,n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](1),console.error("Failed to load image:",n.t0);case 10:case"end":return n.stop()}}),n,null,[[1,7]])})))),{isLoaded:t,onLoad:function(){return t.value=!0},onError:function(){return console.error("Image load error:",e.src)}}}},oe=ie;var se=(0,d.A)(oe,X,Z,!1,null,"4fe73b3e",null);const ae=se.exports;var ce=function(){var e=this,t=e._self._c;return e.musicUrl?t("div",{staticClass:"music-player"},[e.isBilibili?t("iframe",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.musicUrl,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"false"}}):e.isNetease?t("iframe",{staticStyle:{width:"330px",height:"86px"},attrs:{src:e.musicUrl,scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"false"}}):e._e()]):e._e()},ue=[];n(4423),n(1699);const le={name:"MusicPlayer",props:{musicUrl:{type:String,required:!0}},computed:{isBilibili:function(){return this.musicUrl.includes("bilibili.com")},isNetease:function(){return this.musicUrl.includes("music.163.com")}}},pe=le;var de=(0,d.A)(pe,ce,ue,!1,null,"1f89c7f5",null);const he=de.exports,me=(0,o.pM)({name:"StoryView",components:{LazyImage:ae,MusicPlayer:he},computed:{section:function(){return this.$store.state.sections.currentSection}}}),ge=me;var fe=(0,d.A)(ge,Q,q,!1,null,"4febdb80",null);const ve=fe.exports;n(2008);var Ae=function(){var e=this,t=e._self._c;return t("div",{staticClass:"settings-container"},[t("h2",[e._v(e._s(e.$t("settings.title")))]),t("div",{staticClass:"settings-form"},[t("label",{attrs:{for:"api-key"}},[e._v(e._s(e.$t("settings.apiKeyLabel")))]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.localSettings.apiKey,expression:"localSettings.apiKey"}],attrs:{type:"password",id:"api-key",placeholder:e.$t("settings.apiKeyPlaceholder"),disabled:e.localSettings.isPublicKey},domProps:{value:e.localSettings.apiKey},on:{input:function(t){t.target.composing||e.$set(e.localSettings,"apiKey",t.target.value)}}}),t("label",{attrs:{for:"api-url"}},[e._v(e._s(e.$t("settings.apiUrlLabel")))]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.localSettings.apiUrl,expression:"localSettings.apiUrl"}],attrs:{type:"text",id:"api-url",placeholder:e.$t("settings.apiUrlPlaceholder")},domProps:{value:e.localSettings.apiUrl},on:{input:function(t){t.target.composing||e.$set(e.localSettings,"apiUrl",t.target.value)}}}),t("label",{attrs:{for:"advanced-model"}},[e._v(e._s(e.$t("settings.advancedModelLabel")))]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.localSettings.advancedModel,expression:"localSettings.advancedModel"}],attrs:{id:"advanced-model"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.localSettings,"advancedModel",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"gpt-4o-mini"}},[e._v("gpt-4o-mini")])]),t("label",{attrs:{for:"basic-model"}},[e._v(e._s(e.$t("settings.basicModelLabel")))]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.localSettings.basicModel,expression:"localSettings.basicModel"}],attrs:{id:"basic-model"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.localSettings,"basicModel",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"gpt-4o-mini"}},[e._v("gpt-4o-mini")])]),t("div",{staticClass:"button-container"},[t("button",{on:{click:e.saveSettings}},[e._v(e._s(e.$t("settings.saveButton")))]),t("button",{on:{click:e.getPublicKey}},[e._v(e._s(e.$t("settings.publicKeyButton")))]),t("button",{on:{click:e.resetSettings}},[e._v(e._s(e.$t("settings.resetButton")))]),t("button",{on:{click:e.showHelp}},[e._v(e._s(e.$t("settings.helpButton")))])])])])},ye=[];const Se={name:"SettingsView",data:function(){return{localSettings:{apiKey:"",apiUrl:"",advancedModel:"",basicModel:"",isPublicKey:!1}}},computed:(0,v.A)({},(0,j.aH)("settings",["apiKey","apiUrl","advancedModel","basicModel","isPublicKey"])),methods:(0,v.A)((0,v.A)({},(0,j.i0)("settings",["loadSettings","saveSettings","getPublicKey","resetSettings"])),{},{saveSettings:function(){var e=this;return(0,i.A)((0,r.A)().mark((function t(){return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.saveSettings(e.localSettings);case 2:e.$toast.success(e.$t("settings.savedMessage"));case 3:case"end":return t.stop()}}),t)})))()},getPublicKey:function(){var e=this;return(0,i.A)((0,r.A)().mark((function t(){var n;return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getPublicKey();case 2:n=t.sent,n?(e.$toast.success(e.$t("settings.publicKeyFetched")),e.loadLocalSettings()):e.$toast.error(e.$t("settings.publicKeyFetchFailed"));case 4:case"end":return t.stop()}}),t)})))()},resetSettings:function(){var e=this;return(0,i.A)((0,r.A)().mark((function t(){return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.resetSettings();case 2:e.loadLocalSettings(),e.$toast.info(e.$t("settings.resetMessage"));case 4:case"end":return t.stop()}}),t)})))()},showHelp:function(){this.$modal.show("settings-help",{title:this.$t("settings.helpTitle"),content:this.$t("settings.helpContent")})},loadLocalSettings:function(){this.localSettings={apiKey:this.apiKey,apiUrl:this.apiUrl,advancedModel:this.advancedModel,basicModel:this.basicModel,isPublicKey:this.isPublicKey}}}),created:function(){this.loadSettings(),this.loadLocalSettings()}},be=Se;var _e=(0,d.A)(be,Ae,ye,!1,null,null,null);const we=_e.exports;o.Ay.use(U.Ay);var Te=[{path:"/",name:"Home",component:H},{path:"/sections",name:"Sections",component:J},{path:"/story",name:"Story",component:ve},{path:"/settings",name:"Settings",component:we},{path:"/review",name:"Review",component:function(){return n.e(438).then(n.bind(n,438))},meta:{title:"reviewTitle"}}],xe=new U.Ay({mode:"history",base:"/"+{VUE_APP_API_URL:"https://api.deepbricks.ai/v1/",NODE_ENV:"production",BASE_URL:"/undefined/"}.BRANCH_NAME+"/",routes:Te});const ke=xe;n(8598),n(739),n(3110);var Ce=n(7135),Ee=(n(113),n(2010),n(5506),n(3921),n(5060)),Ie=(n(5086),n(9449),n(1392),n(1396),n(2362)),Pe={ADVANCED:"advanced",BASIC:"basic"},Oe=(0,Ie.A)((0,Ie.A)({},Pe.ADVANCED,"gpt-4o-mini"),Pe.BASIC,"gpt-4o-mini"),Ne="settings";function Me(){return Re.apply(this,arguments)}function Re(){return Re=(0,i.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=localStorage.getItem(Ne),e.abrupt("return",t?JSON.parse(t):Le());case 2:case"end":return e.stop()}}),e)}))),Re.apply(this,arguments)}function Le(){return{apiKey:"",apiUrl:"https://api.deepbricks.ai/v1/",advancedModel:"gpt-4o-mini",basicModel:"gpt-4o-mini",isPublicKey:!1}}function Ue(e){var t=JSON.parse(localStorage.getItem("settings"));return t&&t[e]||Oe[e]}var De={ADVANCED:"advanced",BASIC:"basic"};function Be(){arguments.length>0&&void 0!==arguments[0]||De.BASIC;return De.ADVANCED,"gpt-4o-mini"}function je(e){return $e.apply(this,arguments)}function $e(){return $e=(0,i.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.ok){e.next=6;break}return e.next=3,t.json();case 3:throw n=e.sent,console.error("错误响应内容:",n),new Error("HTTP error! status: ".concat(t.status));case 6:return e.next=8,t.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),$e.apply(this,arguments)}var Ke=function(){function e(){(0,ee.A)(this,e),this.decoder=new TextDecoder("utf-8"),this.buffer=""}return(0,te.A)(e,[{key:"handleStream",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t,n){var i,o,s,a,c,u,l,p,d,h,m;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=t.body.getReader(),o="",s=!0;case 3:if(!s){e.next=27;break}return e.next=6,i.read();case 6:if(a=e.sent,c=a.done,u=a.value,!c){e.next=11;break}return e.abrupt("break",27);case 11:this.buffer+=this.decoder.decode(u,{stream:!0}),l=this.buffer.split("\n"),p=0;case 14:if(!(p<l.length-1)){e.next=24;break}if(d=l[p],!d.startsWith("data: ")){e.next=21;break}if(h=d.slice(6),"[DONE]"!==h){e.next=20;break}return e.abrupt("break",24);case 20:try{m=JSON.parse(h),m.choices&&m.choices[0].delta.content&&(o+=m.choices[0].delta.content,n(o))}catch(r){console.error("JSON解析错误:",r)}case 21:p++,e.next=14;break;case 24:this.buffer=l[l.length-1],e.next=3;break;case 27:return e.abrupt("return",o);case 28:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"fetchStream",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t,n,i){var o;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,(0,v.A)((0,v.A)({},n),{},{headers:(0,v.A)((0,v.A)({},n.headers),{},{Accept:"text/event-stream"})}));case 3:if(o=e.sent,o.ok){e.next=6;break}throw new Error("HTTP error! status: ".concat(o.status));case 6:return e.next=8,this.handleStream(o,i);case 8:return e.abrupt("return",e.sent);case 11:throw e.prev=11,e.t0=e["catch"](0),console.error("流式请求错误:",e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()}])}(),Ge=function(){function e(t,n,r,i,o,s){(0,ee.A)(this,e),this.startEvent=t,this.commonKnowledge=n,this.GMDetails=r,this.playerInfo=i,this.sectionObjective=o,this.endConditions=s,this.streamHandler=new Ke,this.endSectionFlag=!1}return(0,te.A)(e,[{key:"validateAction",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={type:"object",properties:{reason:{type:"string"},suggestion:{type:"string"},isValid:{type:"boolean"},specificAction:{type:"string"}},required:["reason","suggestion","isValid","specificAction"],additionalProperties:!1},i="\n作为游戏主持人，请评估玩家是否有能力进行他描述的行动，背景：\n\n开始事件：".concat(this.startEvent,"\n公共知识：").concat(this.commonKnowledge,"\nGM细节：").concat(this.GMDetails,"\n\n玩家信息：\n").concat(this.playerInfo,"\n\n上一回合：\n").concat(this.getLastRound(),"\n\n本回合玩家行动：").concat(t,"\n注意，玩家的行为可以胡闹，你主要判断可行性，只要有能力做到，就可以做。\n请用JSON格式回答，包含以下字段：\n- reason: 解释玩家行动是否可行的原因\n- suggestion: 如果行动不可行，给出的建议。如果可行，则留空。\n- isValid: 玩家行动是否可行的结论（布尔值）\n- specificAction: 请具体描述玩家实际做的事情和说得话，避免歧义，同时也尽量保留原话，最重要的是具体化对象。例如，如果玩家说'你好'，可以描述为'向在场的人问好'，或者判断到是向谁问好。如果不可行，可以留空。如果玩家使用了特殊能力或技能，请具体说明使用的是哪个能力，对能力的效果至少要有一句描写。注意，使用能力必须要是玩家主动发动，因为会消耗灵力的，如果玩家没有明说，就不要发动能力。"),e.next=4,this.callLargeLanguageModel(i,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"summarizeActions",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t,n,i,o){var s,a,c,u;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={type:"object",properties:{triggerChecks:{type:"array",items:{type:"object",properties:{id:{type:"string"},triggerCondition:{type:"string"},currentProgress:{type:"string"},isTriggered:{type:"boolean"}},required:["id","triggerCondition","currentProgress","isTriggered"],additionalProperties:!1}},collision:{type:"string"},summary:{type:"array",items:{type:"object",properties:{name:{type:"string"},note:{type:"string"},successProbability:{type:"string",enum:["impossible","unlikely","possible","likely","certain"],description:"行动成功的可能性"}},required:["name","note","successProbability"],additionalProperties:!1}},endReasons:{type:"array",items:{type:"object",properties:{condition:{type:"string"},isMet:{type:"boolean"}},required:["condition","isMet"],additionalProperties:!1}},endSectionFlag:{type:"boolean"},suggestions:{type:"array",items:{type:"string"}}},required:["triggerChecks","endReasons","endSectionFlag","collision","summary","suggestions"],additionalProperties:!1},a=this.getOptimizedHistory(),c="请考虑以下背景信息和优化后的对话历史：\n\n起始事件：".concat(this.startEvent,"\n公共信息：").concat(this.commonKnowledge,"\n主持人信息：").concat(this.GMDetails,"\n结束条件：\n").concat(this.endConditions.map((function(e,t){return"".concat(t+1,". ").concat(e)})).join("\n"),"\n\n优化后的对话历史：\n").concat(a,"\n\n主角目标：").concat(this.sectionObjective,"\n\n现在，请分析这个回合中每个角色的行动：\n主角行动：").concat(t,"\n\n其他角色行动：\n").concat(Object.entries(n).map((function(e){var t=(0,Ce.A)(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r.action)})).join("\n"),"\n\n当前回合数：").concat(o,"\n\n剧情触发器列表：\n").concat(i.filter((function(e){return!e.consumed&&!e.triggerCondition.startsWith("第")})).map((function(e){return"- ID: ".concat(e.id,", 触发条件: ").concat(e.triggerCondition)})).join("\n"),'\n\n请按照指定的JSON格式回复，包括以下字段：\n- triggerChecks: 一个数组，包含每个剧情触发器的以下信息：\n    触发器列表为空的时候留空数组。\n  - id: 触发器ID\n  - triggerCondition: 触发条件\n  - currentProgress: 当前触发进度的简单描述\n  - isTriggered: 布尔值，表示该触发器是否在这个回合被触发\n- collision: 角色之间行动的冲突，哪个角色做的可能让另一个角色达不到最终的效果\n- summary: 一个数组，包含每个角色的名字、行动结果注释和成功可能性。\n  - name: 角色名字\n  - note: 对该行动的结论性判定，例如"攻击"、"防御"、"行动"等，只简单写行动类型，不写成败。\n  - successProbability: 行动成功的可能性，必须是以下五个选项之一："impossible"（不可能）、"unlikely"（不太可能）、"possible"（可能）、"likely"（很可能）、"certain"（必然）。如果异能用对了方式，那就是certain。\n- endReasons: 一个数组,包含每个结束条件及其是否满足的布尔值:\n  - condition: 结束条件\n  - isMet: 布尔值,表示该条件是否满足\n- endSectionFlag: 布尔值,是否结束该桥段\n- suggestions: 一个数组，包含1-2个对主角继续推进剧情的建议。这些建议应该考虑当前情况和桥段目标。'),e.next=5,this.callLargeLanguageModel(c,s);case 5:return u=e.sent,u.summary=u.summary.map((function(e){var t;switch(e.successProbability){case"impossible":t=.05;break;case"unlikely":t=.25;break;case"possible":t=.5;break;case"likely":t=.65;break;case"certain":t=.9;break;default:t=.5}return(0,v.A)((0,v.A)({},e),{},{isSuccessful:Math.random()<t})})),i.forEach((function(e){if(e.triggerCondition.startsWith("第")&&e.triggerCondition.endsWith("回合")){var t=parseInt(e.triggerCondition.replace(/[^0-9]/g,""));o===t&&u.triggerChecks.push({id:e.id,triggerCondition:e.triggerCondition,currentProgress:"当前是第".concat(o,"回合"),isTriggered:!0})}})),u.endSectionFlag=u.endReasons.some((function(e){return e.isMet})),this.endSectionFlag=u.endSectionFlag,e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"generateFinalResult",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t,n,i,o){var s,a,c,u,l=this;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.getOptimizedHistory(),c=[{name:this.getSelectedCharacter(),action:n,isSuccessful:null===(s=t.summary.find((function(e){return e.name===l.getSelectedCharacter()})))||void 0===s?void 0:s.isSuccessful}].concat((0,Ee.A)(Object.entries(i).map((function(e){var n=(0,Ce.A)(e,2),r=n[0],i=n[1],o=t.summary.find((function(e){return e.name===r}));return{name:r,action:i.action,isSuccessful:null===o||void 0===o?void 0:o.isSuccessful}})))),u="请考虑以下背景信息、优化后的对话历史和触发的剧情触发器：\n\n起始事件：".concat(this.startEvent,"\n公共信息：").concat(this.commonKnowledge,"\n主持人信息：").concat(this.GMDetails,"\n\n过去回合历史：\n").concat(a,"\n\n本回合各角色的行动和结果：\n").concat(c.map((function(e){return"".concat(e.name,": ").concat(e.action,"\n判定: ").concat(e.isSuccessful?"成功":"失败或有意外")})).join("\n\n"),"\n行动有冲突的情况，你可自行斟酌。\n\n本回合触发的剧情触发器：\n").concat(o.map((function(e){return e.content})).join("\n"),"\n\n请小说化地描述这个新的回合的结果，包括每个角色说出来的话、做的动作等。请用第三人称方式描写。请确保描述中自然地包含每个角色实际成功或失败的行动，以及触发的剧情触发器。注意你的回复会直接增量展示为小说内容，所以不要写前导后缀提示。也不要写太多内容，不要写重复了。也不要描写主角").concat(this.getSelectedCharacter(),"的心理活动或主观气氛。写三个自然段就行。如果有剧情触发器的话，必须体现在你的描述里，优先级很高。"),e.next=5,this.callLargeLanguageModelStream(u);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n,r,i){return e.apply(this,arguments)}return t}()},{key:"getOptimizedHistory",value:function(){var e;return(null===(e=this.$store)||void 0===e?void 0:e.state.interaction.optimizedConversationHistory.map((function(e){return"".concat(e.role,": ").concat(e.content)})).join("\n"))||""}},{key:"getSelectedCharacter",value:function(){var e;return(null===(e=this.$store)||void 0===e?void 0:e.state.game.selectedCharacter)||""}},{key:"callLargeLanguageModel",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t,n){var i,o;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.deepbricks.ai/v1/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat({VUE_APP_API_URL:"https://api.deepbricks.ai/v1/",NODE_ENV:"production",BASE_URL:"/undefined/"}.VUE_APP_API_KEY),Accept:"application/json"},body:JSON.stringify({model:Be(De.BASIC),messages:[{role:"user",content:t}],response_format:{type:"json_schema",json_schema:{name:"moderator_response",schema:n,strict:!0}},max_tokens:1e3})});case 2:return i=e.sent,e.next=5,je(i);case 5:return o=e.sent,e.abrupt("return",JSON.parse(o.choices[0].message.content));case 7:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"callLargeLanguageModelStream",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i,o=this;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat({VUE_APP_API_URL:"https://api.deepbricks.ai/v1/",NODE_ENV:"production",BASE_URL:"/undefined/"}.VUE_APP_API_KEY),Accept:"application/json"},body:JSON.stringify({model:Be(De.BASIC),messages:[{role:"user",content:t}],max_tokens:1e3,stream:!0})},i="",e.next=4,this.streamHandler.fetchStream("https://api.deepbricks.ai/v1/",n,(function(e){i=e,o.$emit("streamUpdate",e)}));case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getLastRound",value:function(){return""}}])}(),He=(n(2712),function(){function e(t,n,r,i,o){(0,ee.A)(this,e),this.name=t.name,this.description=t.description,this.personality=t.personality,this.goals=t.goals,this.sectionGuidance=i,this.memory=[],this.debugMode=!1,this.commonKnowledge=n,this.startEvent=r,this.privateMemory=[],this.maxPrivateMemoryLength=5,this.characterTags=this.loadCharacterTag(t.characterTags,o)}return(0,te.A)(e,[{key:"loadCharacterTag",value:function(e,t){return e.reduce((function(e,n){return t[n]?e[n]=t[n]:console.warn("标签键未找到: ".concat(n)),e}),{})}},{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.debugMode&&console.log("[DEBUG AI ".concat(this.name,"] ").concat(e),t)}},{key:"createPrompt",value:function(e){var t=this.memory.slice(-5).map((function(e){return"".concat(e.role,": ").concat(e.content)})).join("\n"),n=this.privateMemory.map((function(e){return"想法: ".concat(e)})).join("\n"),r=Object.entries(this.characterTags).map((function(e){var t=(0,Ce.A)(e,2),n=t[0],r=t[1];return"".concat(n,"：").concat(r)})).join("\n");return"你是".concat(this.name,"。").concat(this.description,"。\n性格：").concat(this.personality,"\n").concat(r,"\n目标：").concat(this.goals.join(", "),"\n公共信息：").concat(this.commonKnowledge,"\n开始事件：").concat(this.startEvent,"\n桥段指导：").concat(this.sectionGuidance,"\n\n最近的公共记忆：\n").concat(t,"\n\n你最近的私人想法：\n").concat(n,"\n\n当前情况：\n").concat(e,"\n再次强调你的角色是").concat(this.name,"。\n\n请用JSON格式回复，包括以下字段：\n1. activeAbilities：明确当前有什么异能正在发动过程中。\n2. checkCanAct：解释并判断你能否行动。比如说有人发动时间减速异能时，你不能行动。注意这是'能否行动'，而不是'要不要行动'。\n3. canAct：布尔值，表示是否能够行动。\n4. thoughts：数组，包含你的思考过程。每个思考步骤应包含思考阶段和内容。思考过程：\n   a. 分析当前情况：仔细考虑当前的环境、其他角色的行动和可能的影响。\n   b. 回顾个人目标：思考你的角色目标，以及当前情况如何影响这些目标。\n   c. 考虑可能的行动：列出几个可能的行动方案，包括可能推动剧情发展的行动。\n   d. 哪个行动最快：判断并选择一个能尽快结束剧情的行动，避免进入对峙。哪怕是满足敌人的目标也行。\n5. action：你的最终行动和说的话。")}},{key:"updateMemory",value:function(e,t){var n=t.thoughts.filter((function(e,t){return 1===t||3===t})).map((function(e){return"".concat(e.step,": ").concat(e.content)})).join("; ");this.privateMemory.push(n),this.privateMemory.length>this.maxPrivateMemoryLength&&this.privateMemory.shift(),this.log("更新私有记忆",{situation:e,response:t,currentPrivateMemory:this.privateMemory})}},{key:"addPrivateThought",value:function(e){this.privateMemory.push(e),this.privateMemory.length>this.maxPrivateMemoryLength&&this.privateMemory.shift(),this.log("添加私人想法",{thought:e,currentPrivateMemory:this.privateMemory})}},{key:"getResponse",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i,o,s,a,c,u;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={type:"object",properties:{activeAbilities:{type:"string"},checkCanAct:{type:"string"},canAct:{type:"boolean"},thoughts:{type:"array",items:{type:"object",properties:{step:{type:"string"},content:{type:"string"}},required:["step","content"],additionalProperties:!1}},action:{type:"string"}},required:["activeAbilities","checkCanAct","canAct","thoughts","action"],additionalProperties:!1},i=this.createPrompt(t),o=[{role:"system",content:i},{role:"user",content:t}],e.prev=3,e.next=6,fetch("https://api.deepbricks.ai/v1/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat({VUE_APP_API_URL:"https://api.deepbricks.ai/v1/",NODE_ENV:"production",BASE_URL:"/undefined/"}.VUE_APP_API_KEY),Accept:"application/json"},body:JSON.stringify({model:Be(De.BASIC),messages:o,response_format:{type:"json_schema",json_schema:{name:"ai_player_response",schema:n,strict:!0}},max_tokens:1e3}),credentials:"include"});case 6:return s=e.sent,e.next=9,je(s);case 9:return a=e.sent,c=JSON.parse(a.choices[0].message.content),this.log("AI 反应",c),!1===c.canAct&&(c.action=c.checkCanAct,c.thoughts=[{step:"无法思考",content:"来不及思考"}]),this.updateMemory(t,c),u={action:c.action},this.log("AI 提交动作",u),e.abrupt("return",u);case 19:throw e.prev=19,e.t0=e["catch"](3),console.error("Error in AI response:",e.t0),e.t0;case 23:case"end":return e.stop()}}),e,this,[[3,19]])})));function t(t){return e.apply(this,arguments)}return t}()}])}()),Ve=function(){function e(t){(0,ee.A)(this,e),this.gameState=t,this.moderator=null,this.aiPlayers={},this.streamHandler=new Ke,this.characterTagBase=null,this.playerInfo=null,this.turnCount=0,this.plotTriggers=[]}return(0,te.A)(e,[{key:"loadCharacterTagBase",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("data/characterTagBase.json?v="+(new Date).getTime());case 3:return t=e.sent,e.next=6,t.json();case 6:this.characterTagBase=e.sent,console.log("加载角色标签库:",this.characterTagBase),e.next=14;break;case 10:throw e.prev=10,e.t0=e["catch"](0),console.error("加载角色标签库时出错:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"initializeGame",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n=this;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.characterTagBase){e.next=3;break}return e.next=3,this.loadCharacterTagBase();case 3:this.aiPlayers={},t.characters.forEach((function(e){e.isAI?n.aiPlayers[e.name]=new He(e,t.commonKnowledge,t.startEvent,e.sectionGuidance,n.characterTagBase):n.mainPlayer=e})),this.initializePlotTriggers(t.plotTriggers),this.currentContext=t.backgroundInfo,this.mainPlayer.isAI||(this.playerInfo=this.createPlayerInfo(this.mainPlayer)),this.moderator=new Ge(t.startEvent,t.commonKnowledge,t.GMDetails,this.playerInfo,t.objective,t.endConditions);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initializePlotTriggers",value:function(e){this.plotTriggers=e.map((function(e){return(0,v.A)((0,v.A)({},e),{},{consumed:!1,memoryCharacter:e.memoryCharacter||null})}))}},{key:"createPlayerInfo",value:function(e){var t=this,n="角色：".concat(e.name,"\n");return n+="描述：".concat(e.description,"\n"),e.characterTags.forEach((function(e){var r=t.getCharacterTag(e);r&&(n+="- ".concat(e,": ").concat(r,"\n"))})),n}},{key:"processMainPlayerAction",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,i,o,s,a,c;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.turnCount++,e.next=3,this.moderator.validateAction(t);case 3:if(n=e.sent,n.isValid){e.next=6;break}return e.abrupt("return",{content:n.reason,isValid:!1,suggestions:n.suggestion?[n.suggestion]:[]});case 6:return i=n.specificAction,e.next=9,this.getAIPlayersResponses(i);case 9:return o=e.sent,e.next=12,this.moderator.summarizeActions(i,o,this.plotTriggers,this.turnCount);case 12:return s=e.sent,a=this.updateTriggeredPlots(s.triggerChecks),e.next=16,this.moderator.generateFinalResult(s,i,o,a);case 16:return c=e.sent,this.updateContext(c),e.abrupt("return",{content:c,isValid:!0,suggestions:s.suggestions,endSectionFlag:s.endSectionFlag});case 19:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateContext",value:function(e){this.currentContext+="\n".concat(e)}},{key:"getAIPlayersResponses",value:function(){var e=(0,i.A)((0,r.A)().mark((function e(t){var n,o;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Object.entries(this.aiPlayers).map(function(){var e=(0,i.A)((0,r.A)().mark((function e(n){var i,o,s,a;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=(0,Ce.A)(n,2),o=i[0],s=i[1],e.next=3,s.getResponse(t);case 3:return a=e.sent,e.abrupt("return",[o,a]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:return o=e.sent,e.abrupt("return",Object.fromEntries(o));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCharacterTag",value:function(e){return this.characterTagBase?this.characterTagBase[e]:null}},{key:"updateTriggeredPlots",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.plotTriggers.find((function(t){return t.id===e.id}));r&&e.isTriggered&&!r.consumed&&(r.consumed=!0,n.push(r),r.memoryCharacter&&t.aiPlayers[r.memoryCharacter]&&t.aiPlayers[r.memoryCharacter].addPrivateThought(r.content))})),n}}])}(),ze={currentSectionId:null,completedSections:[],unlockedSections:[],globalInfluencePoints:[],storyTitle:"",storyContent:"",gameManager:null,suggestions:[],isLoading:!1,moderator:null,conversationHistory:[],streamHandler:new Ke,streamingContent:"",showTutorial:!1,tutorialContent:{title:"",content:""},isSubmitting:!1,isCooldown:!1,selectedCharacter:"罗伯特",currentSection:null,currentIsReplay:!1,optimizedConversationHistory:[],turnCount:0,plotTriggers:[]},Fe={SET_CURRENT_SECTION:function(e,t){e.currentSection=t},SET_COMPLETED_SECTIONS:function(e,t){e.completedSections=t},SET_UNLOCKED_SECTIONS:function(e,t){e.unlockedSections=t},SET_GLOBAL_INFLUENCE_POINTS:function(e,t){e.globalInfluencePoints=t},SET_STORY_TITLE:function(e,t){e.storyTitle=t},SET_STORY_CONTENT:function(e,t){e.storyContent=t},SET_GAME_MANAGER:function(e,t){e.gameManager=t},SET_SUGGESTIONS:function(e,t){e.suggestions=t},SET_LOADING:function(e,t){e.isLoading=t},SET_MODERATOR:function(e,t){e.moderator=t},ADD_TO_CONVERSATION_HISTORY:function(e,t){e.conversationHistory.push(t)},UPDATE_STREAMING_CONTENT:function(e,t){e.streamingContent=t},SET_SHOW_TUTORIAL:function(e,t){e.showTutorial=t},SET_TUTORIAL_CONTENT:function(e,t){e.tutorialContent=t},SET_SUBMITTING:function(e,t){e.isSubmitting=t},SET_COOLDOWN:function(e,t){e.isCooldown=t},SET_SELECTED_CHARACTER:function(e,t){e.selectedCharacter=t},SET_CURRENT_IS_REPLAY:function(e,t){e.currentIsReplay=t},ADD_CONVERSATION_HISTORY:function(e,t){e.conversationHistory.push(t)},ADD_OPTIMIZED_CONVERSATION_HISTORY:function(e,t){e.optimizedConversationHistory.push(t)},INCREMENT_TURN_COUNT:function(e){e.turnCount++},SET_PLOT_TRIGGERS:function(e,t){e.plotTriggers=t},RESET_STATE:function(e){e.isSubmitting=!1,e.isCooldown=!1,e.conversationHistory=[],e.optimizedConversationHistory=[],e.currentSection=null,e.currentIsReplay=!1,e.turnCount=0,e.plotTriggers=[]}},Ye={initializeGameState:function(e){var t=e.commit,n=e.dispatch,r=n("save/loadSave",null,{root:!0});r?(t("SET_CURRENT_SECTION",r.currentSectionId),t("SET_COMPLETED_SECTIONS",r.completedSections),t("SET_UNLOCKED_SECTIONS",r.unlockedSections),t("SET_GLOBAL_INFLUENCE_POINTS",r.globalInfluencePoints)):(t("SET_CURRENT_SECTION",null),t("SET_COMPLETED_SECTIONS",[]),t("SET_UNLOCKED_SECTIONS",[1]),t("SET_GLOBAL_INFLUENCE_POINTS",[]))},newGame:function(e){var t=e.dispatch;t("save/clearSave",null,{root:!0}),t("initializeGameState")},continueGame:function(e){var t=e.dispatch;t("initializeGameState")},updateGameState:function(e,t){var n=e.state,r=e.dispatch,i=t.sectionId;r("save/saveSave",{currentSectionId:i,completedSections:n.completedSections,unlockedSections:n.unlockedSections,globalInfluencePoints:n.globalInfluencePoints},{root:!0})},initializeGameManager:function(e,t){var n=e.commit,r=e.state,i=new Ve(r);n("SET_GAME_MANAGER",i);var o=new Ge(t.startEvent,t.commonKnowledge,t.GMDetails,r.playerInfo,t.objective,t.endConditions);n("SET_MODERATOR",o)},processUserInput:function(e,t){return(0,i.A)((0,r.A)().mark((function n(){var i,o,s,a;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.commit,o=e.state,s=e.dispatch,i("SET_SUBMITTING",!0),n.prev=2,n.next=5,o.gameManager.processMainPlayerAction(t,(function(e){s("clearSuggestions"),i("ADD_OPTIMIZED_CONVERSATION_HISTORY",{role:"user",content:e})}));case 5:if(a=n.sent,!a.isValid){n.next=14;break}return n.next=9,s("updateConversationWithResult",a.finalResult);case 9:if(!o.gameManager.moderator.endSectionFlag){n.next=12;break}return n.next=12,s("handleSectionEnd");case 12:n.next=15;break;case 14:i("ADD_TO_CONVERSATION_HISTORY",{role:"system",content:a.feedback});case 15:n.next=20;break;case 17:n.prev=17,n.t0=n["catch"](2),console.error("处理用户输入时出错:",n.t0);case 20:return n.prev=20,i("SET_SUBMITTING",!1),i("SET_COOLDOWN",!0),setTimeout((function(){i("SET_COOLDOWN",!1)}),1e3),n.finish(20);case 25:case"end":return n.stop()}}),n,null,[[2,17,20,25]])})))()},initializeGame:function(e,t){return(0,i.A)((0,r.A)().mark((function n(){var i,o;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.commit,o=e.dispatch,i("SET_LOADING",!0),n.prev=2,n.next=5,o("initializeGameManager");case 5:return n.next=7,o("showGameTutorial");case 7:i("SET_STORY_TITLE",t.title),i("SET_STORY_CONTENT",t.backgroundInfo);case 9:return n.prev=9,i("SET_LOADING",!1),n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[2,,9,12]])})))()},handleOutcome:function(e,t){return(0,i.A)((0,r.A)().mark((function n(){var i,o,s,a,c;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.commit,o=e.dispatch,s=t.sectionId,a=t.summary,c=t.isReplay,n.prev=2,!a.objective){n.next=13;break}if(c){n.next=7;break}return n.next=7,o("updateGameState",{sectionId:s,result:{objectiveAchieved:a.objective,influencePoints:a.influencePoints}});case 7:if(i("ADD_TO_CONVERSATION_HISTORY",{role:"system",content:"".concat(a.objective_judge,"\n桥段目标完成")}),c){n.next=11;break}return n.next=11,o("review/storeSectionReview",{sectionId:s,conversationHistory:ze.conversationHistory,storyContent:document.getElementById("storyContent").innerHTML},{root:!0});case 11:n.next=14;break;case 13:i("ADD_TO_CONVERSATION_HISTORY",{role:"system",content:"".concat(a.objective_judge,"\n桥段目标未达成")});case 14:n.next=20;break;case 16:throw n.prev=16,n.t0=n["catch"](2),console.error("处理结果时出错:",n.t0),n.t0;case 20:case"end":return n.stop()}}),n,null,[[2,16]])})))()},processStreamingResponse:function(e,t){return(0,i.A)((0,r.A)().mark((function n(){var i,o,s;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.commit,o=e.state,s={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat({VUE_APP_API_URL:"https://api.deepbricks.ai/v1/",NODE_ENV:"production",BASE_URL:"/undefined/"}.VUE_APP_API_KEY)},body:JSON.stringify({model:Ue(Pe.BASIC),messages:[{role:"user",content:t}],max_tokens:1e3,stream:!0})},n.prev=2,n.next=5,o.streamHandler.fetchStream("https://api.deepbricks.ai/v1/",s,(function(e){i("UPDATE_STREAMING_CONTENT",e)}));case 5:n.next=11;break;case 7:throw n.prev=7,n.t0=n["catch"](2),console.error("Error in streaming response:",n.t0),n.t0;case 11:case"end":return n.stop()}}),n,null,[[2,7]])})))()},showGameTutorial:function(e){var t=e.commit,n={title:"游戏教程",content:'\n        <p>你可以把本游戏理解为<strong>跑团（DND或COC）</strong>、<strong>语C</strong>、<strong>剧本杀</strong>或<strong>过家家</strong>🧑‍🤝‍🧑。本游戏制作时面向的玩家是<strong>喜欢剧情向游戏</strong>，愿意<strong>认真扮演角色</strong>🎭  的语C、跑团玩家👥。</p>\n        <ol>\n          <li>📝 <strong>目标</strong>：在每一个桥段里，你需要完成<strong>桥段目标</strong>🎯，目标可能是<strong>沟通</strong>💬、<strong>战斗</strong>⚔️、<strong>解密</strong>🧩等。</li>\n          <li>🎮 <strong>操作</strong>：根据你的人设和起始事件，在对话框中打字输入以<strong>你的角色的角度</strong>进行的行动、说的话🗣️。比如输入"我挥起武器说，与我何干！"，不需要特别注意格式。</li>\n          <li>💡 <strong>技巧</strong>：很多角色有<strong>超能力</strong>🔮，比如银月篇主角罗伯特，可以<strong>减缓时间流速</strong>🕰️，你可以接住敌方扔来的飞刀扔回去🗡️，也能准确地瞄准你要攻击的物件🎯，只要你能想到。</li>\n        </ol>\n\n        <ul>\n          <li>⚠️ <strong>注意</strong>：如果出现输入之后无回复，可以回<strong>主菜单-设置</strong>⚙️里面点"<strong>恢复默认设置</strong>🔄"。一般是初始化的网络问题🌐。</li>\n          <li>🔍 <strong>注意</strong>：高亮有颜色的文字可以点🔗。</li>\n          <li>📜 <strong>注意</strong>：在<strong>桥段剧本</strong>之外，主持人给出的信息不完全保真（比如问队友问题，可能会得到不正确的回复🤔），可以完全取信的是非大模型的<strong>桥段剧本</strong>、<strong>初始事件</strong>、<strong>词条解释</strong>。</li>\n        </ul>\n      '};t("SET_TUTORIAL_CONTENT",n),t("SET_SHOW_TUTORIAL",!0)},handleUserInput:function(e){return(0,i.A)((0,r.A)().mark((function t(){var n,i,o,s;return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.commit,i=e.state,o=e.dispatch,!i.isSubmitting&&!i.isCooldown){t.next=3;break}return t.abrupt("return");case 3:if(s=i.userInput,s){t.next=6;break}return t.abrupt("return");case 6:if(n("ADD_CONVERSATION_HISTORY",{role:"user",content:s}),o("updateDisplay",{role:"user",content:s}),!(i.conversationHistory.length>40)){t.next=12;break}return t.next=11,o("endSection");case 11:return t.abrupt("return");case 12:return t.next=14,o("processUserInput",s);case 14:case"end":return t.stop()}}),t)})))()},callLargeLanguageModel:function(e,t){return(0,i.A)((0,r.A)().mark((function n(){var i,o,s;return(0,r.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.state,n.next=3,fetch(i.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i.apiKey),Accept:"application/json"},body:JSON.stringify({model:Ue(Pe.BASIC),messages:[{role:"user",content:t}],max_tokens:1e3}),credentials:"include"});case 3:return o=n.sent,n.next=6,o.json();case 6:return s=n.sent,n.abrupt("return",s.choices[0].message.content);case 8:case"end":return n.stop()}}),n)})))()}},We={hasSave:function(e){return null!==e.currentSectionId},getLastRound:function(e){var t=e.conversationHistory.slice(-5);return t.map((function(e){return"".concat(e.role,": ").concat(e.content)})).join("\n")},isSubmitting:function(e){return e.isSubmitting},isCooldown:function(e){return e.isCooldown},selectedCharacter:function(e){return e.selectedCharacter},currentSection:function(e){return e.currentSection},conversationHistory:function(e){return e.conversationHistory},optimizedConversationHistory:function(e){return e.optimizedConversationHistory},gameManager:function(e){return e.gameManager},turnCount:function(e){return e.turnCount},plotTriggers:function(e){return e.plotTriggers}};const Je={namespaced:!0,state:ze,mutations:Fe,actions:Ye,getters:We},Qe={namespaced:!0,state:{isProcessing:!1},mutations:{SET_PROCESSING:function(e,t){e.isProcessing=t}},actions:{handleUserInput:function(e){return(0,i.A)((0,r.A)().mark((function t(){var n,i,o,s;return(0,r.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.commit,i=e.dispatch,o=e.rootState,!o.game.isSubmitting&&!o.game.isCooldown){t.next=3;break}return t.abrupt("return");case 3:if(s=o.game.userInput,s){t.next=6;break}return t.abrupt("return");case 6:return n("game/ADD_CONVERSATION_HISTORY",{role:"user",content:s},{root:!0}),t.next=9,i("game/processUserInput",s,{root:!0});case 9:case"end":return t.stop()}}),t)})))()}}},qe={namespaced:!0,state:{currentView:"menu"},mutations:{SET_CURRENT_VIEW:function(e,t){e.currentView=t}},actions:{initializeUI:function(e){var t=e.commit;t("SET_CURRENT_VIEW","menu")},showSettings:function(e){var t=e.commit;t("SET_CURRENT_VIEW","settings")},hideSettings:function(e){var t=e.commit;t("SET_CURRENT_VIEW","menu")}}};o.Ay.use(j.Ay);const Xe=new j.Ay.Store({modules:{game:Je,interaction:Qe,ui:qe}});var Ze=n(4765);o.Ay.use(Ze.A);var et={settings:{title:"设置",apiKeyLabel:"API Key",apiKeyPlaceholder:"输入你的API Key",apiUrlLabel:"API URL",apiUrlPlaceholder:"输入API URL",advancedModelLabel:"进阶模型 (用于桥段总结)",basicModelLabel:"基本模型 (用于其他操作)",saveButton:"保存设置",publicKeyButton:"获取公共key",resetButton:"恢复默认设置",helpButton:"这是什么？",savedMessage:"设置已保存",publicKeyFetched:"公共 Key 已成功获取并保存",resetMessage:"设置已恢复默认",helpTitle:"帮助信息",helpContent:"\n      <p>本游戏<strong>基于</strong>可访问<strong>大语言模型</strong>的接口API进行，您可自行寻找相关API服务，默认API地址不构成推荐建议</p>\n      <p>第一次打开游戏网页时会自动尝试获取公共key，所以您可能直接开始游戏就可以游玩了。</p>\n      <p>公共key是作者买来给大家玩的</p>\n      <p>如遇无法输入API KEY，可以刷新网页</p>\n    ",publicKeyFetchFailed:"获取公共 Key 失败，请检查网络连接或稍后再试",apiKeyDisabled:"API Key 已被禁用，因为正在使用公共 Key",text:"设置"},reviewTitle:"桥段回顾",returnToMenu:"返回主菜单",noReviewRecords:"暂无桥段回顾记录。",rename:"重命名",delete:"删除",viewDetails:"查看详情",reviewDetails:"回顾详情",exportAsHTML:"导出为HTML",exportAsImage:"导出为长图",exportAsMultipleImages:"导出为多图",enterNewTitle:"请输入新的标题",confirmDelete:"您确定要删除这条回顾记录吗？",close:"关闭",newGame:"开始新游戏",continueGame:"继续游戏",reviewRecords:"回顾记录",importSave:"导入存档",exportSave:"导出存档",deleteSave:"删除存档",confirmImport:"您确定要导入并覆盖存档吗？此操作无法撤销。您可以先导出自己的存档进行备份。",success:"成功",error:"错误",importSuccess:"存档已成功导入",tutorial:{title:"游戏教程",close:"关闭",understand:"我明白了",content:{intro:"你可以把本游戏理解为..."}}};const tt=new Ze.A({locale:"zh-CN",messages:{"zh-CN":et}});var nt=n(4822),rt=["buttons"],it={install:function(e){var t=(0,o.createApp)({}).mount(document.createElement("div"));this.EventBus=t,e.component("base-modal",m),e.config.globalProperties.$modal={show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.buttons,r=(0,nt.A)(t,rt);n&&(r.scopedSlots={buttons:function(){return n.map((function(e){return{render:function(){return(0,o.h)("button",{class:"button",onClick:e.handler},e.text)}}}))}}),it.EventBus.$emit("show",(0,v.A)({name:e},r))},hide:function(e){it.EventBus.$emit("hide",e)},EventBus:it.EventBus}}};const ot=it;function st(){return at.apply(this,arguments)}function at(){return at=(0,i.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Me();case 2:new o.Ay({router:ke,store:Xe,i18n:tt,render:function(e){return e(L)}}).$mount("#app");case 3:case"end":return e.stop()}}),e)}))),at.apply(this,arguments)}o.Ay.use(ot),o.Ay.config.productionTip=!1,st()},3005:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9klEQVQ4jWNgwA3mAPEfKJ6FRx1OANL4H4r/EFLMAsSmQMwG5UshaYZhEagcSI0VVA8cLIYqegzE/UB8EYsBR4C4DojvQPmLYJrNsSgmFoNcwhCFQ/ISEOdB8WUcahJABrAC8QQg/oummQPJixxohvwC4gYgZkYOh1YkBXkMmCAfSb4OizxDGwkGtCNLsAPxRDQvXEbzAicQX0GS/wv1Nsj7DGkM2APoMtTWfDTNyDgCZIAxmu2kYFuYE6dBBa4BcQ0DJNGgKz4PxL1A/BzKX4ccDoxArA7ETFC+CBYDJKByPEDsjBZGWAFJmQkbmMWAyM4zcSkCACP+g11NunLfAAAAAElFTkSuQmCC"},477:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,(()=>{var e=[];n.O=(t,r,i,o)=>{if(!r){var s=1/0;for(l=0;l<e.length;l++){for(var[r,i,o]=e[l],a=!0,c=0;c<r.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((e=>n.O[e](r[c])))?r.splice(c--,1):(a=!1,o<s&&(s=o));if(a){e.splice(l--,1);var u=i();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,i,o]}})(),(()=>{n.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return n.d(t,{a:t}),t}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[]))})(),(()=>{n.u=e=>"assets/js/"+e+".965f3107.js"})(),(()=>{n.miniCssF=e=>"assets/css/"+e+".c3b7f7bc.css"})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="beyond-books-vue:";n.l=(r,i,o,s)=>{if(e[r])e[r].push(i);else{var a,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var p=u[l];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==t+o){a=p;break}}a||(c=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(h);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}}})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.p="/undefined/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,r,i,o)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",n.nc&&(s.nonce=n.nc);var a=n=>{if(s.onerror=s.onload=null,"load"===n.type)i();else{var r=n&&n.type,a=n&&n.target&&n.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+a+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=r,c.request=a,s.parentNode&&s.parentNode.removeChild(s),o(c)}};return s.onerror=s.onload=a,s.href=t,r?r.parentNode.insertBefore(s,r.nextSibling):document.head.appendChild(s),s},t=(e,t)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var i=n[r],o=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(o===e||o===t))return i}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){i=s[r],o=i.getAttribute("data-href");if(o===e||o===t)return i}},r=r=>new Promise(((i,o)=>{var s=n.miniCssF(r),a=n.p+s;if(t(s,a))return i();e(r,a,null,i,o)})),i={524:0};n.f.miniCss=(e,t)=>{var n={438:1};i[e]?t.push(i[e]):0!==i[e]&&n[e]&&t.push(i[e]=r(e).then((()=>{i[e]=0}),(t=>{throw delete i[e],t})))}}})(),(()=>{var e={524:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=o);var s=n.p+n.u(t),a=new Error,c=r=>{if(n.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}};n.l(s,c,"chunk-"+t,t)}},n.O.j=t=>0===e[t];var t=(t,r)=>{var i,o,[s,a,c]=r,u=0;if(s.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)var l=c(n)}for(t&&t(r);u<s.length;u++)o=s[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self["webpackChunkbeyond_books_vue"]=self["webpackChunkbeyond_books_vue"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n.O(void 0,[504],(()=>n(6135)));r=n.O(r)})();