"use strict";(self["webpackChunkbeyond_books_vue"]=self["webpackChunkbeyond_books_vue"]||[]).push([[3797],{6178:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var a=n(4048),r=n(388),o=(n(2675),n(9463),n(8706),n(113),n(8980),n(1629),n(4114),n(2010),n(6099),n(3500),n(641)),i=n(33),s=n(953),l=n(3751),c=n(6278),u=n(5220),v=n(6992),d=n(9410),h={class:"min-h-screen w-screen bg-gradient-to-r from-white to-tech-light overflow-hidden"},f={class:"relative z-10 flex flex-col h-screen w-full pb-safe"},p={class:"flex-none pt-4 md:pt-8 px-4 md:px-8 relative z-20"},m={class:"flex justify-between items-center"},x={class:"text-3xl font-bold text-tech-primary text-stroke-sm"},k={class:"text-tech-secondary mt-2 text-stroke-sm"},g={class:"flex-1 relative flex flex-col items-center min-h-0 pt-12"},w={class:"relative w-full h-[60vh] md:h-[70vh] flex items-center justify-center"},b=["onClick"],y=["src","alt"],L={key:1,class:"h-[50vh] aspect-[2/3] bg-gray-200 flex items-center justify-center"},C={xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"}},_={class:"flex-none pb-4 md:pb-8 px-4 md:px-8 relative z-20"},j={class:"text-center space-y-2 md:space-y-4"},E={class:"text-xl md:text-2xl font-bold text-tech-primary text-stroke-sm"},M={class:"text-sm md:text-base text-tech-secondary max-w-2xl mx-auto text-stroke-sm"},S={key:0,class:"text-sm text-red-500 font-medium"},I={class:"flex justify-center mt-4 md:mt-8"},z=["disabled"];const R=Object.assign({name:"CharacterSelectView"},{__name:"CharacterSelectView",setup:function(e){var t=(0,c.Pj)(),n=(0,u.rd)(),R=(0,v.s9)(),X=R.t,A=(0,o.WQ)("$modal"),P=(0,o.EW)((function(){var e;return(null===(e=t.state.sections.scenarioConfig)||void 0===e?void 0:e.characters)||[]})),W=(0,o.EW)({get:function(){var e,n=(null===(e=t.state.sections.scenarioConfig)||void 0===e?void 0:e.characters)||[],a=t.getters["gameState/selectedCharacter"];return a?n.find((function(e){return e.name===a})):n.find((function(e){return!0===e.isDefault}))||n[0]},set:function(e){B.value=e}}),B=(0,s.KR)(null),D=function(e){var t=P.value.findIndex((function(t){return t.id===e.id})),n=P.value.findIndex((function(e){var t;return e.id===(null===(t=B.value)||void 0===t?void 0:t.id)}));if(t!==n){var a=P.value.length,r=360/a*(t-n);Math.abs(r)>180&&(r=r>0?r-360:r+360),H.value-=r,B.value=e}},F=function(e){return e.portraitPath?d.u.getImageUrl("".concat(e.portraitPath,".png")):d.u.getImageUrl("default-character.png")},U=(0,o.EW)((function(){return!t.getters["save/hasSave"]})),V=function(){var e=(0,r.A)((0,a.A)().mark((function e(){var r;return(0,a.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(W.value){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.dispatch("gameState/changeCharacter",W.value.name);case 5:if(r=t.state.sections.currentScenario,!U.value){e.next=11;break}return e.next=9,t.dispatch("save/loadScenarioSave",r);case 9:return e.next=11,t.dispatch("save/saveSave");case 11:return e.next=13,t.dispatch("sections/loadSectionsIndex");case 13:console.log("".concat(U.value?"新游戏":"继续游戏","角色选择完成")),n.push("/sections"),e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("角色选择失败:",e.t0),A.show("error",{title:X("error"),content:X("characterSelectError"),type:"normal"});case 21:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(){return e.apply(this,arguments)}}(),K=function(){U.value&&t.dispatch("save/clearSave"),n.push("/")},H=(0,s.KR)(0),Q=function(e){var t=P.value.length,n=360/t*e+H.value,a=.35*window.innerWidth,r=.08*window.innerHeight,i=n*Math.PI/180,s=Math.sin(i)*a,l=-Math.cos(i)*r,c=Math.abs((n%360+360)%360-180)/180,u=1-.6*c,v=1-.7*c;return c<.1&&(0,o.dY)((function(){B.value=P.value[e]})),{transform:"translate(".concat(s,"px, ").concat(l,"px) scale(").concat(u,")"),zIndex:Math.round(100-100*c),transition:"all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",filter:"brightness(".concat(v,")")}},T=function(){H.value+=360/P.value.length,O()},J=function(){H.value-=360/P.value.length,O()},O=function(){var e=P.value.length,t=Math.round(-H.value/(360/e))%e,n=(t%e+e)%e;B.value=P.value[n]},Y=function(e){return t.getters["sections/isCharacterUnlocked"](e)},$=function(e){return t.getters["sections/getCharacterUnlockDescription"](e)};return(0,o.sV)((function(){var e=P.value.find((function(e){return!0===e.isDefault}))||P.value[0];if(e){B.value=e;var t=P.value.findIndex((function(t){return t.id===e.id}));-1!==t&&(H.value=180-t*(360/P.value.length))}P.value.forEach((function(e){e.portraitPath&&d.u.preloadImage("".concat(e.portraitPath,".png"))}));var n=function(e){"ArrowLeft"===e.key?T():"ArrowRight"===e.key&&J()};window.addEventListener("keydown",n),(0,o.hi)((function(){window.removeEventListener("keydown",n)}))})),function(e,t){var n,a;return(0,o.uX)(),(0,o.CE)("div",h,[t[5]||(t[5]=(0,o.Lk)("div",{class:"fixed inset-0 bg-white z-0"},[(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-r from-white to-tech-light opacity-50"})],-1)),(0,o.Lk)("div",f,[(0,o.Lk)("div",p,[(0,o.Lk)("div",m,[(0,o.Lk)("h2",x,(0,i.v_)((0,s.R1)(X)("game.selectCharacter")),1),(0,o.Lk)("button",{onClick:K,class:"flex items-center gap-2 text-tech-primary hover:text-tech-primary/80 transition-colors"},[t[0]||(t[0]=(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),(0,o.eW)(" "+(0,i.v_)((0,s.R1)(X)("common.returnToMenu")),1)])]),(0,o.Lk)("p",k,(0,i.v_)((0,s.R1)(X)("game.selectCharacterDesc")),1)]),(0,o.Lk)("div",g,[(0,o.Lk)("div",{class:"absolute inset-0 flex items-center justify-between px-4 md:px-8 z-10"},[(0,o.Lk)("button",{class:"h-full px-8 flex items-center justify-center hover:bg-black/5 transition-colors focus:outline-none",onClick:T},t[1]||(t[1]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 md:h-12 md:w-12 text-tech-primary opacity-50 hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),(0,o.Lk)("button",{class:"h-full px-8 flex items-center justify-center hover:bg-black/5 transition-colors focus:outline-none",onClick:J},t[2]||(t[2]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 md:h-12 md:w-12 text-tech-primary opacity-50 hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),(0,o.Lk)("div",w,[(0,o.bF)(l.F,{name:"character-rotate"},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(P.value,(function(e,n){var a,r,s;return(0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"absolute",style:(0,i.Tr)(Q(n))},[(0,o.Lk)("div",{class:(0,i.C4)(["character-frame",{active:(null===(a=W.value)||void 0===a?void 0:a.id)===e.id,locked:!Y(e)}]),onClick:function(t){return D(e)}},[Y(e)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:F(e),alt:e.name,class:(0,i.C4)(["h-[50vh] aspect-[2/3] object-cover",{"opacity-100":(null===(r=B.value)||void 0===r?void 0:r.id)===e.id,"opacity-50":(null===(s=B.value)||void 0===s?void 0:s.id)!==e.id}])},null,10,y)):((0,o.uX)(),(0,o.CE)("div",L,[((0,o.uX)(),(0,o.CE)("svg",C,t[3]||(t[3]=[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"},null,-1)]))),t[4]||(t[4]=(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-b from-gray-100/10 to-gray-300/10 pointer-events-none"},null,-1))]))],10,b)],4)})),128))]})),_:1})])]),(0,o.Lk)("div",_,[(0,o.Lk)("div",j,[(0,o.Lk)("h3",E,(0,i.v_)(null===(n=B.value)||void 0===n?void 0:n.name),1),(0,o.Lk)("p",M,(0,i.v_)(null===(a=B.value)||void 0===a?void 0:a.description),1),Y(B.value)?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("p",S,(0,i.v_)($(B.value)),1)),(0,o.Lk)("div",I,[(0,o.Lk)("button",{onClick:V,disabled:!B.value||!Y(B.value),class:"w-full md:w-auto px-6 md:px-8 py-3 bg-tech-primary text-white rounded-xl shadow-tech transition-all duration-300 hover:bg-tech-primary/90 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"},(0,i.v_)(B.value?Y(B.value)?(0,s.R1)(X)("game.startJourney"):(0,s.R1)(X)("game.characterLocked"):(0,s.R1)(X)("game.selectCharacterFirst")),9,z)])])])])])}}});var X=n(6262);const A=(0,X.A)(R,[["__scopeId","data-v-e6a0b1ee"]]),P=A}}]);