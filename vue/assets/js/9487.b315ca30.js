"use strict";(self["webpackChunkbeyond_books_vue"]=self["webpackChunkbeyond_books_vue"]||[]).push([[9487],{9487:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var n=a(4048),r=a(388),o=(a(2675),a(9463),a(8706),a(113),a(8980),a(1629),a(4114),a(2010),a(6099),a(3500),a(641)),i=a(33),s=a(953),l=a(3751),c=a(6278),u=a(5220),d=a(6992),v=a(9410),h=a(6083),f={class:"min-h-screen w-screen bg-gradient-to-r from-white to-tech-light overflow-hidden"},p={class:"relative z-10 flex flex-col h-screen w-full pb-safe"},m={class:"fixed top-0 left-0 right-0 pt-4 md:pt-8 px-4 md:px-8 z-30 bg-gradient-to-b from-white via-white/90 to-transparent"},x={class:"flex justify-between items-center"},k={class:"text-3xl font-bold text-tech-primary text-stroke-sm"},g={class:"text-tech-secondary mt-2 text-stroke-sm"},w={class:"flex-1 relative flex flex-col items-center min-h-0"},b={class:"relative w-full h-[60vh] md:h-[70vh] flex items-center justify-center"},y=["onClick"],C=["src","alt"],L={key:1,class:"h-[50vh] aspect-[2/3] bg-gray-200 flex items-center justify-center"},_={xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))"}},E={class:"fixed bottom-0 left-0 right-0 pb-4 md:pb-8 px-4 md:px-8 z-30 bg-gradient-to-t from-white via-white/90 to-transparent"},j={class:"text-center space-y-2 md:space-y-4"},M={class:"text-xl md:text-2xl font-bold text-tech-primary text-stroke-sm"},S={class:"text-sm md:text-base text-tech-secondary max-w-2xl mx-auto text-stroke-sm"},I={key:0,class:"text-sm text-red-500 font-medium"},z={class:"flex justify-center mt-4 md:mt-8"},R=["disabled"];const A=Object.assign({name:"CharacterSelectView"},{__name:"CharacterSelectView",setup:function(e){var t=(0,c.Pj)(),a=(0,u.rd)(),A=(0,d.s9)(),X=A.t,P=(0,o.WQ)("$modal"),W=(0,o.EW)((function(){var e;return(null===(e=t.state.sections.scenarioConfig)||void 0===e?void 0:e.characters)||[]})),F=(0,o.EW)({get:function(){var e,a=(null===(e=t.state.sections.scenarioConfig)||void 0===e?void 0:e.characters)||[],n=t.getters["gameState/selectedCharacter"];return n?a.find((function(e){return e.name===n})):a.find((function(e){return!0===e.isDefault}))||a[0]},set:function(e){B.value=e}}),B=(0,s.KR)(null),D=function(e){var t=W.value.findIndex((function(t){return t.id===e.id})),a=W.value.findIndex((function(e){var t;return e.id===(null===(t=B.value)||void 0===t?void 0:t.id)}));if(t!==a){var n=W.value.length,r=360/n*(t-a);Math.abs(r)>180&&(r=r>0?r-360:r+360),Q.value-=r,B.value=e}},H=function(e){return e.portraitPath?v.u.getImageUrl("".concat(e.portraitPath,".png")):v.u.getImageUrl("default-character.png")},U=(0,o.EW)((function(){return!t.getters["save/hasSave"]})),V=function(){var e=(0,r.A)((0,n.A)().mark((function e(){var r;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(F.value){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.dispatch("gameState/changeCharacter",F.value.name);case 5:if(r=t.state.sections.currentScenario,!U.value){e.next=11;break}return e.next=9,t.dispatch("save/loadScenarioSave",r);case 9:return e.next=11,t.dispatch("save/saveSave");case 11:return e.next=13,t.dispatch("sections/loadSectionsIndex");case 13:console.log("".concat(U.value?"新游戏":"继续游戏","角色选择完成")),a.push("/sections"),e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("角色选择失败:",e.t0),P.show("error",{title:X("error"),content:X("characterSelectError"),type:"normal"});case 21:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(){return e.apply(this,arguments)}}(),K=function(){U.value&&t.dispatch("save/clearSave"),a.push("/")},Q=(0,s.KR)(0),T=function(e){var t=W.value.length,a=360/t*e+Q.value,n=.35*window.innerWidth,r=.08*window.innerHeight,i=a*Math.PI/180,s=Math.sin(i)*n,l=-Math.cos(i)*r,c=Math.abs((a%360+360)%360-180)/180,u=1-.6*c,d=1-.7*c;return c<.1&&(0,o.dY)((function(){B.value=W.value[e]})),{transform:"translate(".concat(s,"px, ").concat(l,"px) scale(").concat(u,")"),zIndex:Math.round(100-100*c),transition:"all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",filter:"brightness(".concat(d,")")}},J=function(){Q.value+=360/W.value.length,Y()},O=function(){Q.value-=360/W.value.length,Y()},Y=function(){var e=W.value.length,t=Math.round(-Q.value/(360/e))%e,a=(t%e+e)%e;B.value=W.value[a]},$=function(e){return t.getters["sections/isCharacterUnlocked"](e)},q=function(e){return t.getters["sections/getCharacterUnlockDescription"](e)};return(0,o.sV)((function(){var e=W.value.find((function(e){return!0===e.isDefault}))||W.value[0];if(e){B.value=e;var t=W.value.findIndex((function(t){return t.id===e.id}));-1!==t&&(Q.value=180-t*(360/W.value.length))}W.value.forEach((function(e){e.portraitPath&&v.u.preloadImage("".concat(e.portraitPath,".png"))}));var a=function(e){"ArrowLeft"===e.key?J():"ArrowRight"===e.key&&O()};window.addEventListener("keydown",a),(0,o.hi)((function(){window.removeEventListener("keydown",a)}))})),function(e,t){var a,n;return(0,o.uX)(),(0,o.CE)("div",f,[t[5]||(t[5]=(0,o.Lk)("div",{class:"fixed inset-0 bg-white z-0"},[(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-r from-white to-tech-light opacity-50"})],-1)),(0,o.Lk)("div",p,[(0,o.Lk)("div",m,[(0,o.Lk)("div",x,[(0,o.Lk)("h2",k,(0,i.v_)((0,s.R1)(X)("game.selectCharacter")),1),(0,o.bF)(h.A,{type:"ghost",onClick:K,class:"min-w-[7.5rem] text-responsive"},{icon:(0,o.k6)((function(){return t[0]||(t[0]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",viewBox:"0 0 20 20",fill:"currentColor"},[(0,o.Lk)("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1)])})),default:(0,o.k6)((function(){return[(0,o.eW)(" "+(0,i.v_)((0,s.R1)(X)("common.returnToMenu")),1)]})),_:1})]),(0,o.Lk)("p",g,(0,i.v_)((0,s.R1)(X)("game.selectCharacterDesc")),1)]),(0,o.Lk)("div",w,[(0,o.Lk)("div",{class:"absolute inset-0 flex items-center justify-between px-4 md:px-8 z-10"},[(0,o.Lk)("button",{class:"h-full px-8 flex items-center justify-center hover:bg-black/5 transition-colors focus:outline-none",onClick:J},t[1]||(t[1]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 md:h-12 md:w-12 text-tech-primary opacity-50 hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),(0,o.Lk)("button",{class:"h-full px-8 flex items-center justify-center hover:bg-black/5 transition-colors focus:outline-none",onClick:O},t[2]||(t[2]=[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 md:h-12 md:w-12 text-tech-primary opacity-50 hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))]),(0,o.Lk)("div",b,[(0,o.bF)(l.F,{name:"character-rotate"},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(W.value,(function(e,a){var n,r,s;return(0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"absolute",style:(0,i.Tr)(T(a))},[(0,o.Lk)("div",{class:(0,i.C4)(["character-frame",{active:(null===(n=F.value)||void 0===n?void 0:n.id)===e.id,locked:!$(e)}]),onClick:function(t){return D(e)}},[$(e)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:H(e),alt:e.name,class:(0,i.C4)(["h-[50vh] aspect-[2/3] object-cover",{"opacity-100":(null===(r=B.value)||void 0===r?void 0:r.id)===e.id,"opacity-50":(null===(s=B.value)||void 0===s?void 0:s.id)!==e.id}])},null,10,C)):((0,o.uX)(),(0,o.CE)("div",L,[((0,o.uX)(),(0,o.CE)("svg",_,t[3]||(t[3]=[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"},null,-1)]))),t[4]||(t[4]=(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-b from-gray-100/10 to-gray-300/10 pointer-events-none"},null,-1))]))],10,y)],4)})),128))]})),_:1})])]),(0,o.Lk)("div",E,[(0,o.Lk)("div",j,[(0,o.Lk)("h3",M,(0,i.v_)(null===(a=B.value)||void 0===a?void 0:a.name),1),(0,o.Lk)("p",S,(0,i.v_)(null===(n=B.value)||void 0===n?void 0:n.description),1),$(B.value)?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("p",I,(0,i.v_)(q(B.value)),1)),(0,o.Lk)("div",z,[(0,o.Lk)("button",{onClick:V,disabled:!B.value||!$(B.value),class:"w-full md:w-auto px-6 md:px-8 py-3 bg-tech-primary text-white rounded-xl shadow-tech transition-all duration-300 hover:bg-tech-primary/90 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"},(0,i.v_)(B.value?$(B.value)?(0,s.R1)(X)("game.startJourney"):(0,s.R1)(X)("game.characterLocked"):(0,s.R1)(X)("game.selectCharacterFirst")),9,R)])])])])])}}});var X=a(6262);const P=(0,X.A)(A,[["__scopeId","data-v-fff5a036"]]),W=P}}]);